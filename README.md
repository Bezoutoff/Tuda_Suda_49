# Tuda Suda 49

[![Docker Build](https://github.com/Bezoutoff/Tuda_Suda_49/actions/workflows/docker-build.yml/badge.svg)](https://github.com/Bezoutoff/Tuda_Suda_49/actions/workflows/docker-build.yml)
[![Docker Publish](https://github.com/Bezoutoff/Tuda_Suda_49/actions/workflows/docker-publish.yml/badge.svg)](https://github.com/Bezoutoff/Tuda_Suda_49/actions/workflows/docker-publish.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

Updown 15m Auto-Order Bot ะดะปั Polymarket.

ะะฒัะพะผะฐัะธัะตัะบะธ ััะฐะฒะธั **10 ะพัะดะตัะพะฒ** (5 ัะตะฝ ร 2 ััะพัะพะฝั) ะฟัะธ ะฟะพัะฒะปะตะฝะธะธ ะฝะพะฒัั updown 15m ะผะฐัะบะตัะพะฒ (BTC, ETH, SOL, XRP).

## ะกะพะดะตัะถะฐะฝะธะต

- [Docker Deployment](#docker-deployment-) - **ะะตะบะพะผะตะฝะดัะตััั ะดะปั VPS**

- [ะกััะฐัะตะณะธั](#ัััะฐัะตะณะธั)
- [ะฃััะฐะฝะพะฒะบะฐ](#ัััะฐะฝะพะฒะบะฐ)
- [ะะตะฝะตัะฐัะธั API ะบะปััะตะน](#ะณะตะฝะตัะฐัะธั-api-ะบะปััะตะน)
- [ะะฐะฟััะบ](#ะทะฐะฟััะบ)
- [ะะฐะบ ัะฐะฑะพัะฐะตั](#ะบะฐะบ-ัะฐะฑะพัะฐะตั)
- [ะะพะฝัะธะณััะฐัะธั (.env)](#ะบะพะฝัะธะณััะฐัะธั-env)
- [ะะพะฝัะธะณััะฐัะธั (src/config.ts)](#ะบะพะฝัะธะณััะฐัะธั-srcconfigts)
- [Troubleshooting](#troubleshooting)
  - [401 Unauthorized](#401-unauthorized--invalid-api-key)
  - [ะะตัะตะณะตะฝะตัะฐัะธั API ะบะปััะตะน](#ะฟะตัะตะณะตะฝะตัะฐัะธั-api-ะบะปััะตะน)
  - [ะะตะดะปะตะฝะฝัะน ัะฟะฐะผ ะพัะดะตัะพะฒ](#ะผะตะดะปะตะฝะฝัะน-ัะฟะฐะผ-ะพัะดะตัะพะฒ-ะผะฐะปะพ-ะฟะพะฟััะพะบ-ะทะฐ-n-ัะตะบัะฝะด)
- [ะะฟัะธะผะธะทะฐัะธะธ](#ะพะฟัะธะผะธะทะฐัะธะธ)
- [ะขะตััะธัะพะฒะฐะฝะธะต Latency](#ัะตััะธัะพะฒะฐะฝะธะต-latency)
- [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ-ะบะฐะบ-ะพัะฟัะฐะฒะปัะตััั-ะฟะพะดะฟะธัะฐะฝะฝัะน-ะพัะดะตั)

## Docker Deployment ๐ณ

**ะะตะบะพะผะตะฝะดัะตััั ะดะปั VPS** - one-click deployment ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะทะฐะฟััะบะพะผ ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ.

### Quick Start

```bash
# 1. Clone repository
git clone https://github.com/Bezoutoff/Tuda_Suda_49.git
cd Tuda_Suda_49

# 2. Configure environment
cp .env.example .env
nano .env  # Fill in: PK, CLOB_API_KEY, CLOB_SECRET, CLOB_PASS_PHRASE, FUNDER

# 3. Start
docker-compose up -d
```

**ะะพัะพะฒะพ!** ะะพั ะทะฐะฟััะตะฝ. Monitoring: `docker-compose logs -f`

### ะงัะพ ะฒะบะปััะฐะตั Docker ะดะตะฟะปะพะน:

- โ **Trading Bot** - PM2 ั Node.js ะฑะพัะฐะผะธ (updown-btc/eth/sol/xrp, telegram-bot)
- โ **Redemption Bot** - Python ะฐะฒัะพะฒัะบัะฟ ะฟะพะทะธัะธะน ะบะฐะถะดัะต 60 ะผะธะฝัั
- โ **Auto-restart** - ะะตัะตะทะฐะฟััะบ ะฟัะธ ะฟะฐะดะตะฝะธะธ
- โ **Log rotation** - ะะฒัะพะผะฐัะธัะตัะบะฐั ัะพัะฐัะธั ะปะพะณะพะฒ
- โ **Health checks** - ะะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั

### Commands

```bash
make up      # Start all services
make logs    # View logs
make down    # Stop all services
make shell   # Enter container
make pm2     # Show PM2 process list
```

### ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

ะกะผ. [README.docker.md](README.docker.md) ะดะปั:
- Detailed configuration
- Monitoring and troubleshooting
- Updating procedure
- Migration from systemd

---

## ะกััะฐัะตะณะธั

| ะฆะตะฝะฐ | ะะฐะทะผะตั | ะญะบัะฟะธัะฐัะธั | ะกัะพัะพะฝะฐ |
|------|--------|------------|---------|
| 0.48 | $7 | ะทะฐ 10 ะผะธะฝ ะดะพ ััะฐััะฐ | UP + DOWN |
| 0.47 | $8 | ะทะฐ 6 ะผะธะฝ ะดะพ ััะฐััะฐ | UP + DOWN |
| 0.46 | $9 | ะทะฐ 2 ะผะธะฝ ะดะพ ััะฐััะฐ | UP + DOWN |
| 0.45 | $10 | ะทะฐ 30 ัะตะบ ะดะพ ััะฐััะฐ | UP + DOWN |
| 0.44 | $10 | ะทะฐ 1 ัะตะบ ะดะพ ััะฐััะฐ | UP + DOWN |

**ะัะพะณะพ:** $88 ะฝะฐ ะผะฐัะบะตั (UP + DOWN)

## ะฃััะฐะฝะพะฒะบะฐ

```bash
npm install
cp .env.example .env
# ะะฐะฟะพะปะฝะธัะต .env ัะฒะพะธะผะธ credentials
```

## ะะตะฝะตัะฐัะธั API ะบะปััะตะน

```bash
npx ts-node src/create-api-key.ts YOUR_PRIVATE_KEY
```

## ะะฐะฟััะบ

```bash
# Polling ะฑะพั (ัะตะบะพะผะตะฝะดัะตััั)
npm run bot-polling btc-updown-15m-1764165600

# ะะปะธ ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝะฐั ะฒะตััะธั (ะฑััััะตะต)
npm run build
npm run bot-fast btc-updown-15m-1764165600
```

### PM2 (ะดะปั VPS)

```bash
pm2 start "node dist/bot-polling.js btc-updown-15m-1764165600" --name "updown-bot"
pm2 logs updown-bot
```

## ะะฐะบ ัะฐะฑะพัะฐะตั

1. **Polling**: ัะฟะฐะผะธั Gamma API ะฟะพะบะฐ ะฝะต ะฟะพะปััะธั token IDs
2. **Pre-sign**: ะฟะพะดะฟะธััะฒะฐะตั ะฒัะต 10 ะพัะดะตัะพะฒ (EIP-712)
3. **TLS warm-up**: ะฟัะพะณัะตะฒะฐะตั HTTPS ัะพะตะดะธะฝะตะฝะธะต
4. **Delay**: ะถะดัั 23.5 ัะตะบ (ะผะฐัะบะตั ะฐะบัะธะฒะธััะตััั ~25 ัะตะบ ะฟะพัะปะต ัะพะทะดะฐะฝะธั)
5. **Spam**: ะพัะฟัะฐะฒะปัะตั `postOrders()` ะบะฐะถะดัะต 2ms ะฟะพะบะฐ ะฒัะต ะฝะต ะฟัะพะนะดัั
6. `timestamp += 900`, ะฟะตัะตัะพะดะธั ะบ ัะปะตะดัััะตะผั ะผะฐัะบะตัั

## ะะพะฝัะธะณััะฐัะธั (.env)

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต |
|------------|----------|
| `PK` | ะัะธะฒะฐัะฝัะน ะบะปัั ะบะพัะตะปัะบะฐ (64 ัะธะผะฒะพะปะฐ ะฑะตะท 0x) |
| `CLOB_API_KEY` | API ะบะปัั Polymarket |
| `CLOB_SECRET` | API ัะตะบัะตั |
| `CLOB_PASS_PHRASE` | API passphrase |
| `FUNDER` | ะะดัะตั funder (ะดะปั POLY_PROXY) |
| `BOT_ORDER_SIZE` | ะะฐะทะผะตั ะพัะดะตัะฐ ะฒ USDC (ะฟะพ ัะผะพะปัะฐะฝะธั: 5) |

## ะะพะฝัะธะณััะฐัะธั (src/config.ts)

| ะะฐัะฐะผะตัั | ะะฟะธัะฐะฝะธะต | Default |
|----------|----------|---------|
| `ORDER_CONFIG` | ะะฐััะธะฒ {price, size, expirationBuffer} | 5 ัะตะฝ, $5-$10 |
| `POLL_INTERVAL_MS` | ะะฝัะตัะฒะฐะป polling Gamma API | 250ms |
| `DELAY_BEFORE_SPAM_MS` | ะะฐะดะตัะถะบะฐ ะฟะพัะปะต pre-sign | **23.5s** |
| `MAX_ORDER_ATTEMPTS` | ะะฐะบัะธะผัะผ ะฟะพะฟััะพะบ | 5000 |
| `PARALLEL_SPAM_REQUESTS` | ะะฐัะฐะปะปะตะปัะฝัั ะทะฐะฟัะพัะพะฒ ะฝะฐ ะพัะดะตั | 20 |

## Troubleshooting

### 401 Unauthorized / Invalid API key

**ะัะพะฑะปะตะผะฐ**: ะัะธะฑะบะฐ `401 Unauthorized` ะธะปะธ `Invalid api key` ะฟัะธ ะพัะฟัะฐะฒะบะต ะพัะดะตัะพะฒ.

**ะัะธัะธะฝะฐ**: ะะฐััะธะฝััะพะฝะธะทะฐัะธั ะฒัะตะผะตะฝะธ ะผะตะถะดั VPS ะธ ัะตัะฒะตัะฐะผะธ Polymarket. ะ ะทะฐะณะพะปะพะฒะบะต `POLY_TIMESTAMP` ะพัะฟัะฐะฒะปัะตััั ะปะพะบะฐะปัะฝะพะต ะฒัะตะผั, ะธ ะตัะปะธ ะพะฝะพ ะพัะปะธัะฐะตััั โ ัะตัะฒะตั ะพัะบะปะพะฝัะตั ะทะฐะฟัะพั.

**ะะตัะตะฝะธะต**: ะ `trading-service.ts` ะดะพะฑะฐะฒะปะตะฝ ะฟะฐัะฐะผะตัั `useServerTime: true` ะฟัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ClobClient:

```typescript
this.client = new ClobClient(
  this.config.clobApiUrl,
  this.config.chainId,
  this.wallet,
  creds,
  this.config.signatureType,
  this.funder,
  undefined,  // baseUrl (deprecated)
  true        // useServerTime - ะธัะฟะพะปัะทะพะฒะฐัั ะฒัะตะผั ัะตัะฒะตัะฐ
);
```

ะญัะพ ะทะฐััะฐะฒะปัะตั ะบะปะธะตะฝั ะธัะฟะพะปัะทะพะฒะฐัั ะฒัะตะผั ัะตัะฒะตัะฐ Polymarket ะฒะผะตััะพ ะปะพะบะฐะปัะฝะพะณะพ.

### ะะตัะตะณะตะฝะตัะฐัะธั API ะบะปััะตะน

ะัะปะธ ะฝัะถะฝะพ ะฟะตัะตัะพะทะดะฐัั API ะบะปััะธ:

```bash
# ะะพะปััะธัั ัะตะบััะธะต ะบะปััะธ
npx ts-node -e "const { ethers } = require('ethers'); const { ClobClient } = require('@polymarket/clob-client'); async function main() { const wallet = new ethers.Wallet('0xYOUR_PK'); const client = new ClobClient('https://clob.polymarket.com', 137, wallet); const keys = await client.getApiKeys(); console.log(keys); } main();"

# ะฃะดะฐะปะธัั ัะตะบััะธะน ะบะปัั
npx ts-node -e "const { ethers } = require('ethers'); const { ClobClient } = require('@polymarket/clob-client'); async function main() { const wallet = new ethers.Wallet('0xYOUR_PK'); const creds = { key: 'YOUR_KEY', secret: 'YOUR_SECRET', passphrase: 'YOUR_PASSPHRASE' }; const client = new ClobClient('https://clob.polymarket.com', 137, wallet, creds); await client.deleteApiKey(); console.log('Deleted'); } main();"

# ะกะพะทะดะฐัั ะฝะพะฒัะน
npx ts-node src/create-api-key.ts YOUR_PRIVATE_KEY
```

**ะะฐะถะฝะพ**: API ะบะปััะธ ะดะตัะตัะผะธะฝะธััะธัะฝะพ ะณะตะฝะตัะธัััััั ะธะท ะฟัะธะฒะฐัะฝะพะณะพ ะบะปััะฐ โ ะดะปั ะพะดะฝะพะณะพ ะบะพัะตะปัะบะฐ ะฒัะตะณะดะฐ ะพะดะธะฝะฐะบะพะฒัะต.

### ะะตะดะปะตะฝะฝัะน ัะฟะฐะผ ะพัะดะตัะพะฒ (ะผะฐะปะพ ะฟะพะฟััะพะบ ะทะฐ N ัะตะบัะฝะด)

**ะัะพะฑะปะตะผะฐ**: ะะพั ะดะตะปะฐะตั ัะพะปัะบะพ ~21 ะฟะพะฟััะบั ะทะฐ 6 ัะตะบัะฝะด, ัะพัั `ORDER_RETRY_INTERVAL_MS: 1`.

**ะัะธัะธะฝะฐ**: HTTP latency, ะฐ ะฝะต ะธะฝัะตัะฒะฐะป ะผะตะถะดั ะฟะพะฟััะบะฐะผะธ. ะะฐะถะดัะน `postSignedOrder()` ะทะฐะฝะธะผะฐะตั ~285ms:

```
HTTP ะทะฐะฟัะพั postOrders():
โโ 1. DNS ัะตะทะพะปะฒ:           ~1ms   (ะบััะธััะตััั)
โโ 2. TCP handshake:        ~5ms   (RTT ะดะพ ัะตัะฒะตัะฐ)
โโ 3. TLS handshake:        ~5ms   (ัะถะต ะตััั ัะตััะธั)
โโ 4. ะกะะะะะ ะะะะะะะขะะ:   ~250ms   โ ะณะปะฐะฒะฝัะน bottleneck!
โ     โโ ะะฐะปะธะดะฐัะธั ะฟะพะดะฟะธัะธ
โ     โโ ะัะพะฒะตัะบะฐ ะฑะฐะปะฐะฝัะฐ
โ     โโ ะัะพะฒะตัะบะฐ allowance
โ     โโ Matching engine
โ     โโ ะะฐะฟะธัั ะฒ ะะ
โโ 5. ะัะฒะตั ัะตัะฒะตัะฐ:       ~20ms
โโ ะะขะะะ:                 ~285ms
```

**ะะตัะตะฝะธะต**: ะะฐัะฐะปะปะตะปัะฝัะต ะทะฐะฟัะพัั. ะะผะตััะพ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพะณะพ ัะฟะฐะผะฐ, ะพัะฟัะฐะฒะปัะตะผ 60 ะทะฐะฟัะพัะพะฒ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ ัะตัะตะท `Promise.all()`:

```typescript
// config.ts
PARALLEL_SPAM_REQUESTS: 60,  // 60 ะฟะฐัะฐะปะปะตะปัะฝัั ะทะฐะฟัะพัะพะฒ

// ะะตะทัะปััะฐั:
// - 60 ะทะฐะฟัะพัะพะฒ ะทะฐ ~285ms = ~210 req/s
// - 6 ัะตะบัะฝะด ัะฟะฐะผะฐ = ~1260 ะฟะพะฟััะพะบ ะฒะผะตััะพ 21
```

**Rate limits** (Polymarket CLOB API):
- `POST /order`: 2400 requests / 10s = **240 req/s**
- ะัะธ 60 ะฟะฐัะฐะปะปะตะปัะฝัั ะทะฐะฟัะพัะฐั ะฟะพะปััะฐะตะผ ~210 req/s โ ะฑะตะทะพะฟะฐัะฝะพ ะฟะพะด ะปะธะผะธัะพะผ

## ะะฟัะธะผะธะทะฐัะธะธ

- **Pre-sign before delay**: ะฟะพะดะฟะธัั ะพัะดะตัะพะฒ ะดะพ ะทะฐะดะตัะถะบะธ, ัะบะพะฝะพะผะธั ~600ms
- **TLS warm-up**: ะฟัะพะณัะตะฒ HTTPS ัะพะตะดะธะฝะตะฝะธั ะฒะพ ะฒัะตะผั delay
- **Stream spam**: ะพัะฟัะฐะฒะบะฐ ะทะฐะฟัะพัะพะฒ ะบะฐะถะดัะต 2ms (ะฒะผะตััะพ batch)
- **23.5s delay**: ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะน timing (27-72 ะฟะพะฟััะบะธ ะฒะผะตััะพ 282-288)
- **useServerTime**: ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒัะตะผะตะฝะธ ัะตัะฒะตัะฐ ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ
- **Parallel spam**: 20 ะฟะฐัะฐะปะปะตะปัะฝัั HTTP ะทะฐะฟัะพัะพะฒ ะฝะฐ ะบะฐะถะดัะน ะธะท 10 ะพัะดะตัะพะฒ

### ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั (VPS Toronto)

| Delay | ะะฝัะตัะฒะฐะป | ะะพะฟััะพะบ ะดะพ ััะฟะตัะฐ |
|-------|----------|-------------------|
| 19s | 0ms | 282 |
| 19s | 0.1ms | 288 |
| 23.5s | 2ms | **72** |
| 23.5s | 2ms + TCP_NODELAY | **27** |

ะะพะดัะพะฑะฝะตะต: [LATENCY_RESULTS.md](LATENCY_RESULTS.md)

## ะขะตััะธัะพะฒะฐะฝะธะต Latency

ะะฒะฐ ัะบัะธะฟัะฐ ะดะปั ะธะทะผะตัะตะฝะธั latency:
- `test-latency.ts` โ Node.js ะฒะตััะธั
- `test-latency-cpp.ts` โ Node.js wrapper + C++ HTTP spam (raw HTTP)

### ะะฐะฟััะบ

```bash
# Node.js ะฒะตััะธั
npm run test-latency btc-updown-15m-1764930600

# C++ ะฒะตััะธั (ะฝะตะฟัะตััะฒะฝัะน ัะตะถะธะผ)
npm run test-latency-cpp btc-updown-15m-1764930600

# ะะฐ VPS ัะตัะตะท PM2
pm2 start "npm run test-latency-cpp btc-updown-15m-1764930600" --name "latency-cpp"
pm2 logs latency-cpp
```

**C++ ะฒะตััะธั ัะฐะฑะพัะฐะตั ะฝะตะฟัะตััะฒะฝะพ**: ะฟะพัะปะต ะพะฑัะฐะฑะพัะบะธ ะผะฐัะบะตัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตัะพะดะธั ะบ ัะปะตะดัััะตะผั (+900 ัะตะบ).

### ะงัะพ ะธะทะผะตััะตััั

| ะะตััะธะบะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| **Polling** | ะัะตะผั ะพะถะธะดะฐะฝะธั ะฟะพัะฒะปะตะฝะธั ะผะฐัะบะตัะฐ ะฒ Gamma API |
| **Signing** | ะัะตะผั ะฟะพะดะฟะธัะธ ะพัะดะตัะฐ (EIP-712, ะปะพะบะฐะปัะฝะพ) |
| **Latency** | ะัะตะผั HTTP POST ะทะฐะฟัะพัะฐ ะดะพ Polymarket ะธ ะพะฑัะฐัะฝะพ |
| **Min/Max/Avg/Median** | ะกัะฐัะธััะธะบะฐ ะฟะพ ะฒัะตะผ ะทะฐะฟัะพัะฐะผ |

### ะคะฐะทั ัะตััะฐ

1. **Polling** โ ะถะดัั ะฟะพัะฒะปะตะฝะธั ะผะฐัะบะตัะฐ (ะทะฐะฟัะพัั ะบ Gamma API ะบะฐะถะดัะต 250ms)
2. **Pre-sign** โ ะฟะพะดะฟะธััะฒะฐะตั 1 ะพัะดะตั (UP @ 0.45)
3. **TLS warm-up** โ ะฟัะพะณัะตะฒะฐะตั HTTPS ัะพะตะดะธะฝะตะฝะธะต (GET /health)
4. **Delay** โ ะถะดัั 23.5 ัะตะบ (ะผะฐัะบะตั ะฐะบัะธะฒะธััะตััั ~25 ัะตะบ ะฟะพัะปะต ัะพะทะดะฐะฝะธั)
5. **Spam** โ ะพัะฟัะฐะฒะปัะตั POST ะทะฐะฟัะพัั ะบะฐะถะดัะต 2ms ะดะพ ััะฟะตัะฐ
6. **Results** โ ะฒัะฒะพะดะธั ััะฐัะธััะธะบั latency
7. **Next market** โ (ัะพะปัะบะพ C++) ะฟะตัะตัะพะดะธั ะบ ัะปะตะดัััะตะผั ะผะฐัะบะตัั

### ะะพะณะธัะพะฒะฐะฝะธะต ะฒ CSV

ะะฑะฐ ัะบัะธะฟัะฐ ะฟะธััั ะฒ **ะตะดะธะฝัะน ัะฐะนะป** `latency.csv`:

```csv
server_time_ms,market_time,sec_to_market,slug,side,price,size,latency_ms,status,order_id,attempt,source
1733401234567,1733402100,865.433,btc-updown-15m-1733402100,UP,0.45,5,285,success,0xa4af61c8...,1,nodejs
1733401234890,1733402100,865.110,btc-updown-15m-1733402100,UP,0.45,5,312,orderbook_not_exist,,2,cpp
```

#### ะะพะปั CSV

| ะะพะปะต | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `server_time_ms` | ะัะตะผั ัะตัะฒะตัะฐ Polymarket ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั (Unix timestamp ร 1000 + ms) |
| `market_time` | Unix timestamp ััะฐััะฐ ะผะฐัะบะตัะฐ |
| `sec_to_market` | ะกะตะบัะฝะดั ะดะพ ััะฐััะฐ ะผะฐัะบะตัะฐ (ะพััะธัะฐัะตะปัะฝะพะต = ะฟะพัะปะต ััะฐััะฐ) |
| `slug` | Slug ะผะฐัะบะตัะฐ |
| `side` | UP ะธะปะธ DOWN |
| `price` | ะฆะตะฝะฐ ะพัะดะตัะฐ |
| `size` | ะะฐะทะผะตั ะฒ USDC |
| `latency_ms` | ะัะตะผั ะพัะฒะตัะฐ API ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั |
| `status` | `success` ะธะปะธ `orderbook_not_exist` |
| `order_id` | ID ะพัะดะตัะฐ (ะฟัััะพ ะฟัะธ ะพัะธะฑะบะต) |
| `attempt` | ะะพะผะตั ะฟะพะฟััะบะธ |
| `source` | `nodejs` ะธะปะธ `cpp` |

#### ะคะธะปัััะฐัะธั ะปะพะณะพะฒ

ะะพะณะธัััััั **ัะพะปัะบะพ**:
- โ ะฃัะฟะตัะฝัะต ะพัะดะตัะฐ (`status: success`)
- โ ะัะธะฑะบะฐ `orderbook does not exist` (ะผะฐัะบะตั ะตัั ะฝะต ะฐะบัะธะฒะตะฝ)

**ะะ ะปะพะณะธัััััั**:
- โ `Duplicated order` (ะพัะดะตั ัะถะต ะฒ ะพัะตัะตะดะธ)
- โ ะััะณะธะต ะพัะธะฑะบะธ

### Summary ัะฐะนะป

ะะพัะปะต ะบะฐะถะดะพะณะพ ะผะฐัะบะตัะฐ ะดะพะฑะฐะฒะปัะตััั ัััะพะบะฐ ะฒ `latency_summary.csv`:

```csv
market_time,slug,total_attempts,success_count,first_success_attempt,min_ms,max_ms,avg_ms,median_ms,source
1733402100,btc-updown-15m-1733402100,50,1,23,245,412,298,285,nodejs
```

### ะะฝะฐะปะธะท ะฒ Python

```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('latency.csv')

# ะัะฐัะธะบ latency vs ะฒัะตะผั ะดะพ ััะฐััะฐ ะผะฐัะบะตัะฐ
for slug in df['slug'].unique():
    m = df[df['slug'] == slug]
    plt.figure(figsize=(12, 6))

    success = m[m['status'] == 'success']
    errors = m[m['status'] == 'orderbook_not_exist']

    plt.scatter(success['sec_to_market'], success['latency_ms'],
                c='green', label='Success', alpha=0.7)
    plt.scatter(errors['sec_to_market'], errors['latency_ms'],
                c='red', label='Orderbook not exist', alpha=0.7)

    plt.axvline(x=0, color='black', linestyle='--', label='Market start')
    plt.xlabel('Seconds to market start')
    plt.ylabel('Latency (ms)')
    plt.title(f'Latency: {slug}')
    plt.legend()
    plt.grid(True)
    plt.savefig(f'latency_{slug}.png', dpi=150)
```

### ะะฝัะตัะฟัะตัะฐัะธั ัะตะทัะปััะฐัะพะฒ

| Latency | ะัะตะฝะบะฐ | ะะพะผะผะตะฝัะฐัะธะน |
|---------|--------|-------------|
| < 150ms | ะัะปะธัะฝะพ | VPS ะฑะปะธะทะบะพ ะบ ัะตัะฒะตัะฐะผ Polymarket |
| 150-300ms | ะฅะพัะพัะพ | ะะพัะผะฐะปัะฝะพะต ัะพะตะดะธะฝะตะฝะธะต |
| 300-500ms | ะกัะตะดะฝะต | ะะฐะปะตะบะพ ะพั ัะตัะฒะตัะพะฒ |
| > 500ms | ะะปะพัะพ | ะะตะบะพะผะตะฝะดัะตััั VPS ะฑะปะธะถะต ะบ ะกะจะ |

### ะะธะทัะฐะปะธะทะฐัะธั (Python)

```bash
# ะฃััะฐะฝะพะฒะบะฐ
pip install pandas matplotlib

# ะะฐะฟััะบ
python scripts/plot_latency.py latency.csv
```

ะกััะพะธั ะดะฒะฐ ะณัะฐัะธะบะฐ:
1. **Latency over time** โ ัะพัะฝัะต ะทะฝะฐัะตะฝะธั (ะผั) ะฝะฐะด ะบะฐะถะดะพะน ัะพัะบะพะน, ะฒัะตะผั ะฒ ัะพัะผะฐัะต HH:MM:SS.mmm
2. **Histogram** โ ัะฐัะฟัะตะดะตะปะตะฝะธะต latency

ะัะฒะพะดะธั ััะฐัะธััะธะบั: min, max, mean, median, std, P95, P99.

### ะะปะธัะฝะธะต ะฝะฐ ัััะตะบัะธะฒะฝะพััั ะฑะพัะฐ

ะัะธ latency 285ms ะทะฐ 6 ัะตะบัะฝะด ัะฟะฐะผะฐ:
```
6000ms / 285ms โ 21 batch ร 20 parallel = ~420 ะฟะพะฟััะพะบ
```

ะัะธ latency 600ms:
```
6000ms / 600ms โ 10 batch ร 20 parallel = ~200 ะฟะพะฟััะพะบ
```

ะะตะฝััะต ะฟะพะฟััะพะบ = ะผะตะฝััะต ัะฐะฝัะพะฒ ััะฟะตัั ะฟะตัะฒัะผ.

## ะััะธัะตะบัััะฐ: ะะฐะบ ะพัะฟัะฐะฒะปัะตััั ะฟะพะดะฟะธัะฐะฝะฝัะน ะพัะดะตั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะญะขะะ 1: ะะะะะะกะฌ (ะปะพะบะฐะปัะฝะพ)                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  createSignedOrder()                                            โ
โ       โ                                                         โ
โ       โผ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  client.createOrder({                                    โ   โ
โ  โ    tokenID: "12345...",   // ID ัะพะบะตะฝะฐ (YES/NO)         โ   โ
โ  โ    price: 0.49,           // ะฆะตะฝะฐ                       โ   โ
โ  โ    side: Side.BUY,        // BUY ะธะปะธ SELL               โ   โ
โ  โ    size: 5,               // ะะฐะทะผะตั ะฒ USDC              โ   โ
โ  โ    expiration: 1764677640 // Unix timestamp             โ   โ
โ  โ  })                                                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ       โ                                                         โ
โ       โผ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  EIP-712 Typed Data Signature                           โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  Wallet.signTypedData(domain, types, order)             โ   โ
โ  โ                                                          โ   โ
โ  โ  ะะพะดะฟะธััะฒะฐะตั ััััะบัััั ะพัะดะตัะฐ ะฟัะธะฒะฐัะฝัะผ ะบะปััะพะผ          โ   โ
โ  โ  ะะตะทัะปััะฐั: signedOrder ั ะฟะพะปะตะผ "signature"             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ะญะขะะ 2: ะะขะะะะะะ (HTTP POST)                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  postSignedOrder(signedOrder)                                   โ
โ       โ                                                         โ
โ       โผ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  HTTP POST https://clob.polymarket.com/order            โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ  Headers:                                                โ   โ
โ  โ    POLY_ADDRESS: 0x77cA26...     (ะฐะดัะตั ะบะพัะตะปัะบะฐ)       โ   โ
โ  โ    POLY_SIGNATURE: 0xabc123...   (ะฟะพะดะฟะธัั L1)           โ   โ
โ  โ    POLY_TIMESTAMP: 1733142600    (ะฒัะตะผั ะทะฐะฟัะพัะฐ)        โ   โ
โ  โ    POLY_API_KEY: xxx             (API ะบะปัั)             โ   โ
โ  โ                                                          โ   โ
โ  โ  Body (JSON):                                            โ   โ
โ  โ  {                                                       โ   โ
โ  โ    "order": {                                            โ   โ
โ  โ      "salt": "123456789",                               โ   โ
โ  โ      "maker": "0x77cA26...",                            โ   โ
โ  โ      "signer": "0x77cA26...",                           โ   โ
โ  โ      "tokenId": "12345...",                             โ   โ
โ  โ      "makerAmount": "5000000",   // 5 USDC (6 decimals) โ   โ
โ  โ      "takerAmount": "10204081",  // shares              โ   โ
โ  โ      "expiration": "1764677640",                        โ   โ
โ  โ      "signatureType": 2,         // POLY_PROXY          โ   โ
โ  โ      "signature": "0xdef456..."  // EIP-712 ะฟะพะดะฟะธัั     โ   โ
โ  โ    },                                                    โ   โ
โ  โ    "orderType": "GTD"                                   โ   โ
โ  โ  }                                                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ       โ                                                         โ
โ       โผ                                                         โ
โ  Response: { "orderID": "0x9327fe88...", "success": true }     โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะปััะตะฒัะต ะผะพะผะตะฝัั:

1. **EIP-712 ะฟะพะดะฟะธัั** โ ะพัะดะตั ะฟะพะดะฟะธััะฒะฐะตััั ะปะพะบะฐะปัะฝะพ ะฟัะธะฒะฐัะฝัะผ ะบะปััะพะผ
2. **ะะฒะฐ ัะธะฟะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ:**
   - `signature` ะฒ ัะตะปะต ะพัะดะตัะฐ โ EIP-712 ะฟะพะดะฟะธัั ัะฐะผะพะณะพ ะพัะดะตัะฐ
   - `POLY_*` ะทะฐะณะพะปะพะฒะบะธ โ ะฐััะตะฝัะธัะธะบะฐัะธั API ะทะฐะฟัะพัะฐ (API key + HMAC)
3. **signatureType: 2 (POLY_PROXY)** โ ัะฐะทัะตัะฐะตั Polymarket ะธัะฟะพะปะฝััั ะพัะดะตัะฐ ะพั ะธะผะตะฝะธ funder

## ะะธัะตะฝะทะธั

MIT
